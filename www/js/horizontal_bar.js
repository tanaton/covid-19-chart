!function(t){function e(e){for(var r,s,o=e[0],h=e[1],c=e[2],u=0,l=[];u<o.length;u++)s=o[u],Object.prototype.hasOwnProperty.call(n,s)&&n[s]&&l.push(n[s][0]),n[s]=0;for(r in h)Object.prototype.hasOwnProperty.call(h,r)&&(t[r]=h[r]);for(d&&d(e);l.length;)l.shift()();return i.push.apply(i,c||[]),a()}function a(){for(var t,e=0;e<i.length;e++){for(var a=i[e],r=!0,o=1;o<a.length;o++){var h=a[o];0!==n[h]&&(r=!1)}r&&(i.splice(e--,1),t=s(s.s=a[0]))}return t}var r={},n={2:0},i=[];function s(e){if(r[e])return r[e].exports;var a=r[e]={i:e,l:!1,exports:{}};return t[e].call(a.exports,a,a.exports,s),a.l=!0,a.exports}s.m=t,s.c=r,s.d=function(t,e,a){s.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:a})},s.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(t,e){if(1&e&&(t=s(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var a=Object.create(null);if(s.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)s.d(a,r,function(e){return t[e]}.bind(null,r));return a},s.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="";var o=window.webpackJsonp=window.webpackJsonp||[],h=o.push.bind(o);o.push=e,o=o.slice();for(var c=0;c<o.length;c++)e(o[c]);var d=h;i.push([89,0]),a()}({0:function(t,e,a){"use strict";a.d(e,"b",(function(){return n})),a.d(e,"i",(function(){return i})),a.d(e,"q",(function(){return s})),a.d(e,"k",(function(){return o})),a.d(e,"m",(function(){return h})),a.d(e,"l",(function(){return c})),a.d(e,"e",(function(){return d})),a.d(e,"d",(function(){return u})),a.d(e,"c",(function(){return l})),a.d(e,"p",(function(){return g})),a.d(e,"j",(function(){return f})),a.d(e,"f",(function(){return p})),a.d(e,"o",(function(){return y})),a.d(e,"g",(function(){return b})),a.d(e,"h",(function(){return m})),a.d(e,"n",(function(){return w})),a.d(e,"a",(function(){return v}));var r=a(1);const n={confirmed:0,deaths:1,recovered:2},i=864e5,s=r.m("%Y%m%d"),o=r.d(",d"),h=r.d(",.3s"),c=r.d(".2f"),d=(new Date(2099,11,31),new Date(2001,0,1),t=>window.btoa(unescape(encodeURIComponent(t)))),u=t=>decodeURIComponent(escape(window.atob(t))),l=t=>parseInt(t,10),g=t=>{if(t.length<8)return new Date(2020,3,1);const e=[t.slice(0,4),t.slice(4,6),t.slice(6)].map(l);return new Date(e[0],e[1]-1,e[2])},f=t=>t.length<8?"2020/04/01":[t.slice(0,4),t.slice(4,6),t.slice(6)].join("/"),p="confirmed",y="liner",b="Japan",m=s(new Date(Date.now()-2*i)),w=["#ff9500","#f62e36","#b5b5ac","#009bbf","#00bb85","#c1a470","#8f76d6","#00ac9b","#9c5e31","#f39700","#e60012","#9caeb7","#00a7db","#009944","#d7c447","#9b7cb6","#00ada9","#bb641d","#e85298","#0079c2","#6cbb5a","#b6007a","#e5171f","#522886","#0078ba","#019a66","#e44d93","#814721","#a9cc51","#ee7b1a","#00a0de"];class v{constructor(t){var e;this.margin={top:10,right:10,bottom:20,left:60},this.svgid=t;const a=document.getElementById(this.svgid);this.width=null!==(e=null==a?void 0:a.offsetWidth)&&void 0!==e?e:1600,this.height=Math.min(this.width,720)-this.margin.top-this.margin.bottom,this.width=this.width-this.margin.left-this.margin.right,this.svg=r.l("#"+this.svgid).append("svg"),this.svg.attr("width",this.width+this.margin.left+this.margin.right+10).attr("height",this.height+this.margin.top+this.margin.bottom+10)}dispose(){const t=document.getElementById(this.svgid);t&&(t.innerHTML="")}clear(){this.svg.selectAll("g").remove()}createDateRange(t,e){const a=[];let r=new Date(t.getTime());for(;r<=e;)a.push(s(r)),r=new Date(r.getTime()+i);return a}}},2:function(t,e,a){"use strict";a.d(e,"b",(function(){return r})),a.d(e,"a",(function(){return n}));class r{constructor(){this.query=[],this.queryIndex={},this.init()}[Symbol.iterator](){let t=0;const e=this.query;return{next:()=>t<e.length?{done:!1,value:e[t++]}:{done:!0,value:null}}}init(){this.query=[],this.queryIndex={}}set(t,e){void 0===this.queryIndex[t]?(this.queryIndex[t]=this.query.length,this.query.push([t,e])):this.query[this.queryIndex[t]]=[t,e]}get(t){var e;return null!==(e=this.query[this.queryIndex[t]][1])&&void 0!==e?e:""}copy(){const t=new r;for(const[e,a]of this)t.set(e,a);return t}filter(t){const e=new r;for(const[a,r]of this)r!==t.get(a)&&e.set(a,r);return e}loadSearchParams(t){const e=new URLSearchParams(t);for(const[t,a]of e)this.set(t,a)}toString(){const t=new URLSearchParams;for(const[e,a]of this)t.append(e,a);const e=t.toString();return""!==e?"?"+e:""}}class n{constructor(t){this.chart=t,this.query=this.createDefaultQuery(),window.addEventListener("popstate",()=>this.updatePage(),!1)}run(t=""){var e;(e="/data/daily_reports/summary.json",new Promise((t,a)=>{n.get(e,e=>{t(JSON.parse(e.responseText))},t=>{a(t)})})).then(e=>{this.chart.addData(e),this.initQuery(t),this.change()}).catch(t=>{console.error(t)})}dispose(){var t;null===(t=this.chart)||void 0===t||t.dispose()}getQuery(){return this.query.copy()}createQuery(t){return t||(t=this.query),t.filter(this.createDefaultQuery()).toString()}updateQuery(t){const e=this.createQuery(t);e!==location.search?(window.history.pushState("","",location.pathname+e),this.updatePage()):window.history.replaceState("","",location.pathname+e)}updatePage(){const t=this.createQuery();this.loadQuery(location.search);const e=this.createQuery();e!==t?this.change():window.history.replaceState("","",location.pathname+e)}update(t){const e=this.getQuery();for(const[a,r]of t)e.set(a,r);this.updateQuery(e)}static get(t,e,a){const r=new XMLHttpRequest;r.ontimeout=()=>{console.error(`The request for ${t} timed out.`),a("ontimeout")},r.onload=()=>{4===r.readyState&&(200===r.status?e(r):console.error(r.statusText))},r.onerror=()=>{console.error(r.statusText),a("onerror")},r.open("GET",t,!0),r.timeout=5e3,r.send(null)}}},89:function(t,e,a){"use strict";a.r(e);var r=a(1),n=a(3),i=a(4),s=a.n(i),o=a(0),h=a(2);const c=[0,0],d=[0,0];class u extends o.a{constructor(t){super(t),this.hbardata=[],this.data={},this.nowdatestr="20200401",this.barheight=10,this.rank=30,this.hbar_x=r.h().domain(c.concat()).range([0,this.width]),this.hbar_y=r.h().domain(d.concat()).range([this.height,0]),this.hbar_xAxis=r.a(this.hbar_x).tickSizeInner(-this.height).tickFormat(o.k).tickPadding(7).ticks(5),this.hbar_yAxis=r.b(this.hbar_y).tickSizeInner(-this.width).tickPadding(7).ticks(5),this.hbar_color=r.j(o.n)}changeData(t){var e;if(!this.raw)return;this.hbardata=[];const a=o.b[t],r=g.slider.date.value,n=void 0!==this.data[r]?this.data[r]:this.data[this.nowdatestr],i=[8e9,-8e9];n.values.sort((t,e)=>e.cdr[a]-t.cdr[a]),this.rank=o.c(g.nowrank);const s=Math.min(n.values.length,this.rank);for(let t=0;t<s;t++){const e=n.values[t],r=e.cdr[a];r<i[0]&&(i[0]=r),r>i[1]&&(i[1]=r),this.hbardata.push({name:e.name,data:r})}this.barheight=this.height/(null!==(e=this.hbardata.length)&&void 0!==e?e:1),this.hbar_x.domain(i),this.hbar_x.nice(),this.hbar_y.domain([s,0])}addData(t){this.raw=t,this.data={};const e=[new Date(2099,11,31),new Date(2001,0,1)],a=[];for(const r in t.countrys){if(!t.countrys.hasOwnProperty(r))continue;const n=t.countrys[r].daily;if(!n||n.length<=0)continue;a.push(r);const i=o.p(n[0].date),s=n[n.length-1],h=o.p(s.date);i.getTime()<e[0].getTime()&&(e[0]=i),h.getTime()>e[1].getTime()&&(e[1]=h);for(const t of n){const e=o.p(t.date);void 0===this.data[t.date]&&(this.data[t.date]={date:e,values:[]}),this.data[t.date].values.push({name:r,cdr:[t.cdr[0],t.cdr[1],t.cdr[2]]})}}this.hbar_color.domain(a),this.nowdatestr=o.q(e[1]),g.slider.date.value=this.nowdatestr,g.slider.date.data=this.createDateRange(e[0],e[1])}resetScale(t){const e=this.hbar_x.domain();switch(t){case"liner":this.hbar_x=r.h(),e[0]=0;break;case"log":this.hbar_x=r.i().clamp(!0),e[0]=1;break;default:}this.hbar_x.range([0,this.width]),this.hbar_x.domain(e),this.hbar_x.nice(),this.hbar_xAxis.scale(this.hbar_x)}draw(){this.hbardata&&(this.hbar=this.svg.selectAll(".hbar").data(this.hbardata).enter().append("g").attr("transform",`translate(${this.margin.left},${this.margin.top})`).attr("class","hbar"),this.hbar.append("rect").style("fill",t=>this.hbar_color(t.name)).attr("x",0).attr("y",(t,e)=>this.hbar_y(e)).attr("width",t=>this.hbar_x(t.data)).attr("height",this.barheight),this.hbar.append("text").attr("class","line").attr("font-size",this.barheight+"px").attr("x",t=>this.hbar_x(t.data)).attr("y",(t,e)=>this.hbar_y(e)+this.barheight).style("fill","black").style("stroke","black").style("stroke-width","0px").text((t,e)=>`${e+1}. ${t.name}`),this.hbar.append("title").text((t,e)=>`country:${t.name}\nrank:${e+1}\ndata:${o.k(t.data)}`),this.svg.append("g").attr("class","x axis").attr("transform",`translate(${this.margin.left},${this.height+this.margin.top})`).call(this.hbar_xAxis),this.svg.append("g").attr("class","y axis").attr("transform",`translate(${this.margin.left},${this.margin.top})`).call(this.hbar_yAxis))}}class l extends h.a{constructor(t=""){super(new u("svghbar")),this.date="20200410",this.run(t)}createDefaultQuery(){const t=new h.b;return t.set("category",o.f),t.set("rank","30"),t.set("xscale",o.o),t.set("date",this.date),t}loadQuery(t){t||(t=location.search),this.query=this.createDefaultQuery(),this.query.loadSearchParams(t),g.nowcategory=this.query.get("category"),g.nowrank=this.query.get("rank"),g.nowxscale=this.query.get("xscale"),g.slider.date.value=this.query.get("date")}initQuery(t=""){const e=g.slider.date.data;e.length>=1&&(this.date=e[e.length-1]),this.loadQuery(t),this.updateQuery()}change(){this.chart.clear(),this.chart.resetScale(g.nowxscale),this.chart.changeData(g.nowcategory),this.chart.draw()}}const g={categorys:[{id:"confirmed",name:"感染数"},{id:"deaths",name:"死亡数"},{id:"recovered",name:"回復数"}],xscales:[{id:"liner",name:"線形"},{id:"log",name:"対数"}],slider:{date:{value:o.h,data:[o.h]}},ranks:[{id:"rank10",name:"上位10ヶ国",value:"10"},{id:"rank30",name:"上位30ヶ国",value:"30"},{id:"rank50",name:"上位50ヶ国",value:"50"},{id:"rank100",name:"上位100ヶ国",value:"100"}],nowcategory:o.f,nowxscale:o.o,nowrank:"30"},f=(new n.default({el:"#container",data:g,components:{VueSlider:s.a},computed:{date:()=>o.j(g.slider.date.value),lastdate:()=>o.j(g.slider.date.data[g.slider.date.data.length-1])},methods:{categoryChange:()=>f.update([["category",g.nowcategory]]),xscaleChange:()=>f.update([["xscale",g.nowxscale]]),sliderChange:()=>f.update([["date",g.slider.date.value]]),rankChange:()=>f.update([["rank",g.nowrank]])}}),new l(location.search))}});
//# sourceMappingURL=horizontal_bar.js.map