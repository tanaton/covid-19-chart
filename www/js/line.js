!function(t){function e(e){for(var i,a,o=e[0],c=e[1],h=e[2],u=0,d=[];u<o.length;u++)a=o[u],Object.prototype.hasOwnProperty.call(r,a)&&r[a]&&d.push(r[a][0]),r[a]=0;for(i in c)Object.prototype.hasOwnProperty.call(c,i)&&(t[i]=c[i]);for(l&&l(e);d.length;)d.shift()();return s.push.apply(s,h||[]),n()}function n(){for(var t,e=0;e<s.length;e++){for(var n=s[e],i=!0,o=1;o<n.length;o++){var c=n[o];0!==r[c]&&(i=!1)}i&&(s.splice(e--,1),t=a(a.s=n[0]))}return t}var i={},r={3:0},s=[];function a(e){if(i[e])return i[e].exports;var n=i[e]={i:e,l:!1,exports:{}};return t[e].call(n.exports,n,n.exports,a),n.l=!0,n.exports}a.m=t,a.c=i,a.d=function(t,e,n){a.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},a.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},a.t=function(t,e){if(1&e&&(t=a(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(a.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)a.d(n,i,function(e){return t[e]}.bind(null,i));return n},a.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return a.d(e,"a",e),e},a.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},a.p="";var o=window.webpackJsonp=window.webpackJsonp||[],c=o.push.bind(o);o.push=e,o=o.slice();for(var h=0;h<o.length;h++)e(o[h]);var l=c;s.push([87,0]),n()}({0:function(t,e,n){"use strict";n.d(e,"c",(function(){return r})),n.d(e,"d",(function(){return s})),n.d(e,"b",(function(){return a})),n.d(e,"k",(function(){return o})),n.d(e,"s",(function(){return c})),n.d(e,"m",(function(){return h})),n.d(e,"o",(function(){return l})),n.d(e,"n",(function(){return u})),n.d(e,"g",(function(){return d})),n.d(e,"f",(function(){return y})),n.d(e,"e",(function(){return f})),n.d(e,"r",(function(){return g})),n.d(e,"l",(function(){return p})),n.d(e,"h",(function(){return m})),n.d(e,"q",(function(){return x})),n.d(e,"i",(function(){return v})),n.d(e,"j",(function(){return w})),n.d(e,"p",(function(){return b})),n.d(e,"a",(function(){return _}));var i=n(1);const r={confirmed:"confirmed",deaths:"deaths",recovered:"recovered"},s={liner:"liner",log:"log"},a={confirmed:0,deaths:1,recovered:2},o=864e5,c=i.m("%Y%m%d"),h=i.d(",d"),l=i.d(",.3s"),u=i.d(".2f"),d=(new Date(2099,11,31),new Date(2001,0,1),t=>window.btoa(unescape(encodeURIComponent(t)))),y=t=>decodeURIComponent(escape(window.atob(t))),f=t=>parseInt(t,10),g=t=>{if(t.length<8)return new Date(2020,3,1);const e=[t.slice(0,4),t.slice(4,6),t.slice(6)].map(f);return new Date(e[0],e[1]-1,e[2])},p=t=>t.length<8?"2020/04/01":[t.slice(0,4),t.slice(4,6),t.slice(6)].join("/"),m=r.confirmed,x=s.liner,v="Japan",w=c(new Date(Date.now()-2*o)),b=["#ff9500","#f62e36","#b5b5ac","#009bbf","#00bb85","#c1a470","#8f76d6","#00ac9b","#9c5e31","#f39700","#e60012","#9caeb7","#00a7db","#009944","#d7c447","#9b7cb6","#00ada9","#bb641d","#e85298","#0079c2","#6cbb5a","#b6007a","#e5171f","#522886","#0078ba","#019a66","#e44d93","#814721","#a9cc51","#ee7b1a","#00a0de"];class _{constructor(t){var e;this.margin={top:10,right:10,bottom:20,left:60},this.svgid=t;const n=document.getElementById(this.svgid);this.width=null!==(e=null==n?void 0:n.offsetWidth)&&void 0!==e?e:1600,this.height=Math.min(this.width,720)-this.margin.top-this.margin.bottom,this.width=this.width-this.margin.left-this.margin.right,this.svg=i.l("#"+this.svgid).append("svg"),this.svg.attr("width",this.width+this.margin.left+this.margin.right+10).attr("height",this.height+this.margin.top+this.margin.bottom+10)}dispose(){const t=document.getElementById(this.svgid);t&&(t.innerHTML="")}clear(){this.svg.selectAll("g").remove()}createDateRange(t,e){const n=[];let i=new Date(t.getTime());for(;i<=e;)n.push(c(i)),i=new Date(i.getTime()+o);return n}}},2:function(t,e,n){"use strict";n.d(e,"b",(function(){return i})),n.d(e,"a",(function(){return r}));class i{constructor(){this.query=[],this.queryIndex={},this.init()}[Symbol.iterator](){let t=0;const e=this.query;return{next:()=>t<e.length?{done:!1,value:e[t++]}:{done:!0,value:null}}}init(){this.query=[],this.queryIndex={}}set(t,e){void 0===this.queryIndex[t]?(this.queryIndex[t]=this.query.length,this.query.push([t,e])):this.query[this.queryIndex[t]]=[t,e]}get(t){var e;return null!==(e=this.query[this.queryIndex[t]][1])&&void 0!==e?e:""}copy(){const t=new i;for(const[e,n]of this)t.set(e,n);return t}filter(t){const e=new i;for(const[n,i]of this)i!==t.get(n)&&e.set(n,i);return e}loadSearchParams(t){const e=new URLSearchParams(t);for(const[t,n]of e)this.set(t,n)}toString(){const t=new URLSearchParams;for(const[e,n]of this)t.append(e,n);const e=t.toString();return""!==e?"?"+e:""}}class r{constructor(t){this.chart=t,this.query=this.createDefaultQuery(),window.addEventListener("popstate",()=>this.updatePage(),!1)}run(t=""){var e;(e="/data/daily_reports/summary.json",new Promise((t,n)=>{r.get(e,e=>{t(JSON.parse(e.responseText))},t=>{n(t)})})).then(e=>{this.chart.addData(e),this.initQuery(t),this.change()}).catch(t=>{console.error(t)})}dispose(){var t;null===(t=this.chart)||void 0===t||t.dispose()}getQuery(){return this.query.copy()}createQuery(t){return t||(t=this.query),t.filter(this.createDefaultQuery()).toString()}updateQuery(t){const e=this.createQuery(t);e!==location.search?(window.history.pushState("","",location.pathname+e),this.updatePage()):window.history.replaceState("","",location.pathname+e)}updatePage(){const t=this.createQuery();this.loadQuery(location.search);const e=this.createQuery();e!==t?this.change():window.history.replaceState("","",location.pathname+e)}update(t){const e=this.getQuery();for(const[n,i]of t)e.set(n,i);this.updateQuery(e)}static get(t,e,n){const i=new XMLHttpRequest;i.ontimeout=()=>{console.error(`The request for ${t} timed out.`),n("ontimeout")},i.onload=()=>{4===i.readyState&&(200===i.status?e(i):console.error(i.statusText))},i.onerror=()=>{console.error(i.statusText),n("onerror")},i.open("GET",t,!0),i.timeout=5e3,i.send(null)}}},87:function(t,e,n){"use strict";n.r(e);var i=n(1),r=n(3),s=n(4),a=n.n(s),o=n(0),c=n(2);const h=o.d,l="country",u="category",d="yscale",y="startdate",f="enddate",g=[new Date(2099,11,31),new Date(2001,0,1)],p=[0,0];class m extends o.a{constructor(t){super(t),this.linedata=[],this.line_x=i.k().domain(g.concat()).range([0,this.width]),this.line_y=i.h().domain(p.concat()).range([this.height,0]),this.line_xAxis=i.a(this.line_x).tickSizeInner(-this.height).tickFormat(o.s).tickPadding(7).ticks(5),this.line_yAxis=i.b(this.line_y).tickSizeInner(-this.width).tickFormat(o.m).tickPadding(7).ticks(5),this.line_line=i.g().curve(i.c).x(t=>this.line_x(t.date)).y(t=>this.line_y(t.data)),this.line_path_d=t=>this.line_line(t.values),this.line_color=i.j(o.p),this.line_path_stroke=t=>this.line_color(t.name)}changeData(t){if(!this.raw)return;this.linedata=[];const e=o.b[t],n=this.raw.countrys,i=this.line_y.domain(),r=[o.r(v.slider.xaxis.value[0]),o.r(v.slider.xaxis.value[1])];i[1]=p[1];const s={};let a=0;for(const t of v.countrys)t.checked&&(s[t.name]={visible:!0,index:a}),a++;for(const t in n){if(!n.hasOwnProperty(t))continue;if(!s[t]||!1===s[t].visible)continue;const a={name:t,values:[]};for(const s of n[t].daily){const t=o.r(s.date);if(t.getTime()<r[0].getTime()||t.getTime()>r[1].getTime())continue;const n=s.cdr[e];n>i[1]&&(i[1]=n),a.values.push({date:t,data:n})}a.values.length>0&&this.linedata.push(a)}this.line_x.domain(r),this.line_y.domain(i),this.line_y.nice()}addData(t){this.raw=t,v.countrys=[];const e=g.concat(),n=[];for(const i in t.countrys){if(!t.countrys.hasOwnProperty(i))continue;n.push(i);const r=t.countrys[i].daily;if(r&&r.length>0){const t=o.r(r[0].date),n=r[r.length-1],s=o.r(n.date);t.getTime()<e[0].getTime()&&(e[0]=t),s.getTime()>e[1].getTime()&&(e[1]=s);const a=n.cdr;v.countrys.push({id:o.g(i),name:i,data:[a[0],a[1],a[2]],checked:!1})}}this.line_color.domain(n),v.slider.xaxis.value=[o.s(e[0]),o.s(e[1])],v.slider.xaxis.data=this.createDateRange(e[0],e[1])}resetScale(t){const e=this.line_y.domain();switch(t){case h.liner:this.line_y=i.h(),e[0]=0;break;case h.log:this.line_y=i.i().clamp(!0),e[0]=1;break;default:}this.line_y.range([this.height,0]),this.line_y.domain(e),this.line_y.nice(),this.line_yAxis.scale(this.line_y)}draw(){this.linedata&&(this.line=this.svg.selectAll(".line").data(this.linedata).enter().append("g").attr("transform",`translate(${this.margin.left},${this.margin.top})`).attr("class","line"),this.line.append("path").attr("class","line").style("stroke",this.line_path_stroke).attr("d",this.line_path_d),this.line.append("text").attr("class","line").attr("font-size","12px").attr("x",t=>{const e=t.values[t.values.length-1];return this.line_x(e.date)-5*t.name.length}).attr("y",t=>this.line_y(t.values[t.values.length-1].data)).style("fill","black").style("stroke","black").style("stroke-width","0px").text(t=>t.name),this.svg.append("g").attr("class","x axis").attr("transform",`translate(${this.margin.left},${this.height+this.margin.top})`).call(this.line_xAxis),this.svg.append("g").attr("class","y axis").attr("transform",`translate(${this.margin.left},${this.margin.top})`).call(this.line_yAxis))}}class x extends c.a{constructor(t=""){super(new m("svgline")),this.countryIndex={},this.countrystr="",this.startdate="20200401",this.enddate="20200410",this.run(t)}createDefaultQuery(){const t=new c.b;return t.set(l,this.countrystr),t.set(u,o.h),t.set(d,o.q),t.set(y,this.startdate),t.set(f,this.enddate),t}loadQuery(t){t||(t=location.search),this.query=this.createDefaultQuery(),this.query.loadSearchParams(t);for(const t of v.countrys)t.checked=!1;this.query.get(l).split("|").forEach(t=>{const e=decodeURI(t);void 0!==this.countryIndex[e]&&(v.countrys[this.countryIndex[e]].checked=!0)}),v.nowcategory=this.query.get(u),v.nowyscale=this.query.get(d),v.slider.xaxis.value=[this.query.get(y),this.query.get(f)]}static countryListStr(){return v.countrys.filter(t=>t.checked).map(t=>t.name).sort().join("|")}initQuery(t=""){const e=v.slider.xaxis.data;e.length>=2&&(this.startdate=e[0],this.enddate=e[e.length-1]),this.countryIndex={};let n=0;for(const t of v.countrys)this.countryIndex[t.name]=n,n++;this.countrystr=v.countrys.map(t=>t.name).sort().join("|"),this.loadQuery(t),this.updateQuery()}change(){this.chart.clear(),this.chart.resetScale(v.nowyscale),this.chart.changeData(v.nowcategory),this.chart.draw()}}const v={categorys:[{id:o.c.confirmed,name:"感染数"},{id:o.c.deaths,name:"死亡数"},{id:o.c.recovered,name:"回復数"}],yscales:[{id:h.liner,name:"線形"},{id:h.log,name:"対数"}],countrys:[],slider:{xaxis:{value:[o.j,o.j],data:[o.j]}},nowcategory:o.h,nowyscale:o.q},w=(new r.default({el:"#container",data:v,components:{VueSlider:a.a},computed:{startdate:()=>o.l(v.slider.xaxis.value[0]),enddate:()=>o.l(v.slider.xaxis.value[1]),lastdate:()=>o.l(v.slider.xaxis.data[v.slider.xaxis.data.length-1])},methods:{categoryChange:()=>w.update([[u,v.nowcategory]]),yscaleChange:()=>w.update([[d,v.nowyscale]]),countryChange:()=>w.update([[l,x.countryListStr()]]),countryCheckAllClick:()=>{for(const t of v.countrys)t.checked=!0;w.update([[l,x.countryListStr()]])},countryUncheckAllClick:()=>{for(const t of v.countrys)t.checked=!1;w.update([[l,""]])},countryCheckBest10Click:()=>{const t={};let e=0;for(const n of v.countrys)n.checked=!1,t[n.name]=e,e++;const n=v.countrys.concat(),i=o.b[v.nowcategory];n.sort((t,e)=>e.data[i]-t.data[i]);const r=Math.min(n.length,10);for(let e=0;e<r;e++){const i=t[n[e].name];v.countrys[i].checked=!0}w.update([[l,x.countryListStr()]])},sliderChange:()=>w.update([[y,v.slider.xaxis.value[0]],[f,v.slider.xaxis.value[1]]])}}),new x(location.search))}});
//# sourceMappingURL=line.js.map