!function(t){function e(e){for(var n,o,s=e[0],d=e[1],c=e[2],h=0,l=[];h<s.length;h++)o=s[h],Object.prototype.hasOwnProperty.call(a,o)&&a[o]&&l.push(a[o][0]),a[o]=0;for(n in d)Object.prototype.hasOwnProperty.call(d,n)&&(t[n]=d[n]);for(u&&u(e);l.length;)l.shift()();return i.push.apply(i,c||[]),r()}function r(){for(var t,e=0;e<i.length;e++){for(var r=i[e],n=!0,s=1;s<r.length;s++){var d=r[s];0!==a[d]&&(n=!1)}n&&(i.splice(e--,1),t=o(o.s=r[0]))}return t}var n={},a={4:0},i=[];function o(e){if(n[e])return n[e].exports;var r=n[e]={i:e,l:!1,exports:{}};return t[e].call(r.exports,r,r.exports,o),r.l=!0,r.exports}o.m=t,o.c=n,o.d=function(t,e,r){o.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},o.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},o.t=function(t,e){if(1&e&&(t=o(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(o.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)o.d(r,n,function(e){return t[e]}.bind(null,n));return r},o.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return o.d(e,"a",e),e},o.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},o.p="";var s=window.webpackJsonp=window.webpackJsonp||[],d=s.push.bind(s);s.push=e,s=s.slice();for(var c=0;c<s.length;c++)e(s[c]);var u=d;i.push([83,0]),r()}({0:function(t,e,r){"use strict";r.d(e,"c",(function(){return a})),r.d(e,"d",(function(){return i})),r.d(e,"b",(function(){return o})),r.d(e,"k",(function(){return s})),r.d(e,"s",(function(){return d})),r.d(e,"m",(function(){return c})),r.d(e,"o",(function(){return u})),r.d(e,"n",(function(){return h})),r.d(e,"g",(function(){return l})),r.d(e,"f",(function(){return f})),r.d(e,"e",(function(){return y})),r.d(e,"r",(function(){return p})),r.d(e,"l",(function(){return v})),r.d(e,"h",(function(){return g})),r.d(e,"q",(function(){return m})),r.d(e,"i",(function(){return w})),r.d(e,"j",(function(){return b})),r.d(e,"p",(function(){return x})),r.d(e,"a",(function(){return q}));var n=r(1);const a={confirmed:"confirmed",deaths:"deaths",recovered:"recovered"},i={liner:"liner",log:"log"},o={confirmed:0,deaths:1,recovered:2},s=864e5,d=n.m("%Y%m%d"),c=n.d(",d"),u=n.d(",.3s"),h=n.d(".2f"),l=(new Date(2099,11,31),new Date(2001,0,1),t=>window.btoa(unescape(encodeURIComponent(t)))),f=t=>decodeURIComponent(escape(window.atob(t))),y=t=>parseInt(t,10),p=t=>{if(t.length<8)return new Date(2020,3,1);const e=[t.slice(0,4),t.slice(4,6),t.slice(6)].map(y);return new Date(e[0],e[1]-1,e[2])},v=t=>t.length<8?"2020/04/01":[t.slice(0,4),t.slice(4,6),t.slice(6)].join("/"),g=a.confirmed,m=i.liner,w="Japan",b=d(new Date(Date.now()-2*s)),x=["#ff9500","#f62e36","#b5b5ac","#009bbf","#00bb85","#c1a470","#8f76d6","#00ac9b","#9c5e31","#f39700","#e60012","#9caeb7","#00a7db","#009944","#d7c447","#9b7cb6","#00ada9","#bb641d","#e85298","#0079c2","#6cbb5a","#b6007a","#e5171f","#522886","#0078ba","#019a66","#e44d93","#814721","#a9cc51","#ee7b1a","#00a0de"];class q{constructor(t){var e;this.margin={top:10,right:10,bottom:20,left:60},this.svgid=t;const r=document.getElementById(this.svgid);this.width=null!==(e=null==r?void 0:r.offsetWidth)&&void 0!==e?e:1600,this.height=Math.min(this.width,720)-this.margin.top-this.margin.bottom,this.width=this.width-this.margin.left-this.margin.right,this.svg=n.l("#"+this.svgid).append("svg"),this.svg.attr("width",this.width+this.margin.left+this.margin.right+10).attr("height",this.height+this.margin.top+this.margin.bottom+10)}dispose(){const t=document.getElementById(this.svgid);t&&(t.innerHTML="")}clear(){this.svg.selectAll("g").remove()}createDateRange(t,e){const r=[];let n=new Date(t.getTime());for(;n<=e;)r.push(d(n)),n=new Date(n.getTime()+s);return r}}},2:function(t,e,r){"use strict";r.d(e,"b",(function(){return n})),r.d(e,"a",(function(){return a}));class n{constructor(){this.query=[],this.queryIndex={},this.init()}[Symbol.iterator](){let t=0;const e=this.query;return{next:()=>t<e.length?{done:!1,value:e[t++]}:{done:!0,value:null}}}init(){this.query=[],this.queryIndex={}}set(t,e){void 0===this.queryIndex[t]?(this.queryIndex[t]=this.query.length,this.query.push([t,e])):this.query[this.queryIndex[t]]=[t,e]}get(t){var e;return null!==(e=this.query[this.queryIndex[t]][1])&&void 0!==e?e:""}copy(){const t=new n;for(const[e,r]of this)t.set(e,r);return t}filter(t){const e=new n;for(const[r,n]of this)n!==t.get(r)&&e.set(r,n);return e}loadSearchParams(t){const e=new URLSearchParams(t);for(const[t,r]of e)this.set(t,r)}toString(){const t=new URLSearchParams;for(const[e,r]of this)t.append(e,r);const e=t.toString();return""!==e?"?"+e:""}}class a{constructor(t){this.chart=t,this.query=this.createDefaultQuery(),window.addEventListener("popstate",()=>this.updatePage(),!1)}run(t=""){var e;(e="/data/daily_reports/summary.json",new Promise((t,r)=>{a.get(e,e=>{t(JSON.parse(e.responseText))},t=>{r(t)})})).then(e=>{this.chart.addData(e),this.initQuery(t),this.change()}).catch(t=>{console.error(t)})}dispose(){var t;null===(t=this.chart)||void 0===t||t.dispose()}getQuery(){return this.query.copy()}createQuery(t){return t||(t=this.query),t.filter(this.createDefaultQuery()).toString()}updateQuery(t){const e=this.createQuery(t);e!==location.search?(window.history.pushState("","",location.pathname+e),this.updatePage()):window.history.replaceState("","",location.pathname+e)}updatePage(){const t=this.createQuery();this.loadQuery(location.search);const e=this.createQuery();e!==t?this.change():window.history.replaceState("","",location.pathname+e)}update(t){const e=this.getQuery();for(const[r,n]of t)e.set(r,n);this.updateQuery(e)}static get(t,e,r){const n=new XMLHttpRequest;n.ontimeout=()=>{console.error(`The request for ${t} timed out.`),r("ontimeout")},n.onload=()=>{4===n.readyState&&(200===n.status?e(n):console.error(n.statusText))},n.onerror=()=>{console.error(n.statusText),r("onerror")},n.open("GET",t,!0),n.timeout=5e3,n.send(null)}}},83:function(t,e,r){"use strict";r.r(e);var n=r(1),a=r(3),i=r(4),o=r.n(i),s=r(0),d=r(2);const c="category",u="date";class h extends s.a{constructor(t){super(t),this.colorReds=n.f("lightpink","red"),this.colorGreens=n.f("lightgreen","green"),this.target=s.h,this.now={confirmed:0,deaths:0,recovered:0},this.nowdatestr="20200401"}resetScale(t){}changeData(t){var e,r;if(!this.data||!this.data.daily)return;this.nodes={name:"世界の様子",value:0,children:[]},this.target=t,this.now={confirmed:0,deaths:0,recovered:0};const n=s.b[t],a=f.slider.date.value,i=void 0!==this.data.daily[a]?this.data.daily[a]:this.data.daily[this.nowdatestr];for(const t in i.countrys){if(!i.countrys.hasOwnProperty(t))continue;const a=i.countrys[t];null===(r=null===(e=this.nodes)||void 0===e?void 0:e.children)||void 0===r||r.push({name:t,value:a.cdr[n],active:a.active}),this.now.confirmed+=a.cdr[0],this.now.deaths+=a.cdr[1],this.now.recovered+=a.cdr[2]}f.confirmed_now=s.m(this.now.confirmed),f.deaths_now=s.m(this.now.deaths),f.recovered_now=s.m(this.now.recovered)}addData(t){var e,r,n,a;this.data={daily:{}};let i=[new Date(2099,0,1),new Date(2e3,0,1)];for(const o in t.countrys){if(!t.countrys.hasOwnProperty(o))continue;const d=t.countrys[o].daily;if(!d||d.length<=0)continue;let c="";for(const t of d){const d=s.r(t.date);if(void 0===this.data.daily[t.date]&&(this.data.daily[t.date]={countrys:{}}),void 0===this.data.daily[t.date].countrys[o]&&(this.data.daily[t.date].countrys[o]={cdr:[0,0,0],active:[0,0]}),this.data.daily[t.date].countrys[o].cdr=[t.cdr[0],t.cdr[1],t.cdr[2]],""!==c&&(null===(r=null===(e=this.data.daily[c])||void 0===e?void 0:e.countrys[o])||void 0===r?void 0:r.cdr)){const e=null===(a=null===(n=this.data.daily[c])||void 0===n?void 0:n.countrys[o])||void 0===a?void 0:a.cdr;e&&(this.data.daily[t.date].countrys[o].active=[t.cdr[0]-t.cdr[1]-t.cdr[2],e[0]-e[1]-e[2]])}d<i[0]&&(i[0]=d),d>i[1]&&(i[1]=d),c=t.date}}this.nowdatestr=s.s(i[1]),f.slider.date.value=this.nowdatestr,f.slider.date.data=this.createDateRange(i[0],i[1])}draw(){if(!this.nodes)return;const t=n.e(this.nodes).sum(t=>t.value).sort((t,e)=>e.data.value-t.data.value),e=n.n().size([this.width,this.height])(t),r=t=>{let e=(t.x1-t.x0+(t.y1-t.y0))/2/5;const r=Math.min(Math.floor((t.y1-t.y0)/3),100);return e>r?e=r:e<5&&(e=5),e},a=this.now[this.target]/1e4,i=this.svg.selectAll("g").data(e.leaves()).join("g").attr("transform",t=>`translate(${t.x0},${t.y0})`);i.append("rect").attr("class","rect_data").attr("width",t=>t.x1-t.x0).attr("height",t=>t.y1-t.y0).style("stroke","black").style("fill",t=>t.data.active?t.data.active[0]>t.data.active[1]?this.colorReds(1-20*Math.max(t.data.active[1]/t.data.active[0]-.95,0)):0!=t.data.active[1]?this.colorGreens(1-20*Math.max(t.data.active[0]/t.data.active[1]-.95,0)):"red":"red"),i.append("text").attr("font-size",t=>r(t)+"px").selectAll("tspan").data(t=>{if(t.data.value<a)return[];const e=r(t),n=[{name:t.data.name,size:e},{name:s.o(t.data.value),size:e}],i=(t=>{if(!t)return"";if(0==t[0])return"";const e=100-t[1]/t[0]*100;return e>0?`▼${s.n(e)}%`:`▲${s.n(e)}%`})(t.data.active);return""!==i&&n.push({name:i,size:e}),n}).join("tspan").attr("x",5).attr("y",(t,e)=>t.size*(e+1)).attr("fill","black").text(t=>t.name),i.append("title").text(t=>`${t.data.name}\n${s.m(t.data.value)}`)}}class l extends d.a{constructor(t=""){super(new h("svgtreemap")),this.date="20200401",this.run(t)}createDefaultQuery(){const t=new d.b;return t.set(c,s.h),t.set(u,this.date),t}loadQuery(t){t||(t=location.search),this.query=this.createDefaultQuery(),this.query.loadSearchParams(t),f.nowcategory=this.query.get(c),f.slider.date.value=this.query.get(u)}initQuery(t=""){const e=f.slider.date.data;e.length>=1&&(this.date=e[e.length-1]),this.loadQuery(t),this.updateQuery()}change(){this.chart.clear(),this.chart.changeData(f.nowcategory),this.chart.draw()}}const f={confirmed_now:"",deaths_now:"",recovered_now:"",categorys:[{id:s.c.confirmed,name:"感染数"},{id:s.c.deaths,name:"死亡数"},{id:s.c.recovered,name:"回復数"}],slider:{date:{value:s.j,data:[s.j]}},nowcategory:s.h},y=(new a.default({el:"#container",data:f,components:{VueSlider:o.a},computed:{date:()=>s.l(f.slider.date.value),lastdate:()=>s.l(f.slider.date.data[f.slider.date.data.length-1])},methods:{categoryChange:()=>y.update([[c,f.nowcategory]]),sliderChange:()=>y.update([[u,f.slider.date.value]])}}),new l(location.search))}});
//# sourceMappingURL=treemap.js.map