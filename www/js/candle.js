!function(t){function e(e){for(var a,s,o=e[0],c=e[1],d=e[2],l=0,u=[];l<o.length;l++)s=o[l],Object.prototype.hasOwnProperty.call(i,s)&&i[s]&&u.push(i[s][0]),i[s]=0;for(a in c)Object.prototype.hasOwnProperty.call(c,a)&&(t[a]=c[a]);for(h&&h(e);u.length;)u.shift()();return r.push.apply(r,d||[]),n()}function n(){for(var t,e=0;e<r.length;e++){for(var n=r[e],a=!0,o=1;o<n.length;o++){var c=n[o];0!==i[c]&&(a=!1)}a&&(r.splice(e--,1),t=s(s.s=n[0]))}return t}var a={},i={1:0},r=[];function s(e){if(a[e])return a[e].exports;var n=a[e]={i:e,l:!1,exports:{}};return t[e].call(n.exports,n,n.exports,s),n.l=!0,n.exports}s.m=t,s.c=a,s.d=function(t,e,n){s.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},s.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(t,e){if(1&e&&(t=s(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(s.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)s.d(n,a,function(e){return t[e]}.bind(null,a));return n},s.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="";var o=window.webpackJsonp=window.webpackJsonp||[],c=o.push.bind(o);o.push=e,o=o.slice();for(var d=0;d<o.length;d++)e(o[d]);var h=c;r.push([90,0]),n()}({0:function(t,e,n){"use strict";n.d(e,"b",(function(){return i})),n.d(e,"i",(function(){return r})),n.d(e,"q",(function(){return s})),n.d(e,"k",(function(){return o})),n.d(e,"m",(function(){return c})),n.d(e,"l",(function(){return d})),n.d(e,"e",(function(){return h})),n.d(e,"d",(function(){return l})),n.d(e,"c",(function(){return u})),n.d(e,"p",(function(){return y})),n.d(e,"j",(function(){return g})),n.d(e,"f",(function(){return p})),n.d(e,"o",(function(){return f})),n.d(e,"g",(function(){return m})),n.d(e,"h",(function(){return w})),n.d(e,"n",(function(){return x})),n.d(e,"a",(function(){return b}));var a=n(1);const i={confirmed:0,deaths:1,recovered:2},r=864e5,s=a.m("%Y%m%d"),o=a.d(",d"),c=a.d(",.3s"),d=a.d(".2f"),h=(new Date(2099,11,31),new Date(2001,0,1),t=>window.btoa(unescape(encodeURIComponent(t)))),l=t=>decodeURIComponent(escape(window.atob(t))),u=t=>parseInt(t,10),y=t=>{if(t.length<8)return new Date(2020,3,1);const e=[t.slice(0,4),t.slice(4,6),t.slice(6)].map(u);return new Date(e[0],e[1]-1,e[2])},g=t=>t.length<8?"2020/04/01":[t.slice(0,4),t.slice(4,6),t.slice(6)].join("/"),p="confirmed",f="liner",m="Japan",w=s(new Date(Date.now()-2*r)),x=["#ff9500","#f62e36","#b5b5ac","#009bbf","#00bb85","#c1a470","#8f76d6","#00ac9b","#9c5e31","#f39700","#e60012","#9caeb7","#00a7db","#009944","#d7c447","#9b7cb6","#00ada9","#bb641d","#e85298","#0079c2","#6cbb5a","#b6007a","#e5171f","#522886","#0078ba","#019a66","#e44d93","#814721","#a9cc51","#ee7b1a","#00a0de"];class b{constructor(t){var e;this.margin={top:10,right:10,bottom:20,left:60},this.svgid=t;const n=document.getElementById(this.svgid);this.width=null!==(e=null==n?void 0:n.offsetWidth)&&void 0!==e?e:1600,this.height=Math.min(this.width,720)-this.margin.top-this.margin.bottom,this.width=this.width-this.margin.left-this.margin.right,this.svg=a.l("#"+this.svgid).append("svg"),this.svg.attr("width",this.width+this.margin.left+this.margin.right+10).attr("height",this.height+this.margin.top+this.margin.bottom+10)}dispose(){const t=document.getElementById(this.svgid);t&&(t.innerHTML="")}clear(){this.svg.selectAll("g").remove()}createDateRange(t,e){const n=[];let a=new Date(t.getTime());for(;a<=e;)n.push(s(a)),a=new Date(a.getTime()+r);return n}}},2:function(t,e,n){"use strict";n.d(e,"b",(function(){return a})),n.d(e,"a",(function(){return i}));class a{constructor(){this.query=[],this.queryIndex={},this.init()}[Symbol.iterator](){let t=0;const e=this.query;return{next:()=>t<e.length?{done:!1,value:e[t++]}:{done:!0,value:null}}}init(){this.query=[],this.queryIndex={}}set(t,e){void 0===this.queryIndex[t]?(this.queryIndex[t]=this.query.length,this.query.push([t,e])):this.query[this.queryIndex[t]]=[t,e]}get(t){var e;return null!==(e=this.query[this.queryIndex[t]][1])&&void 0!==e?e:""}copy(){const t=new a;for(const[e,n]of this)t.set(e,n);return t}filter(t){const e=new a;for(const[n,a]of this)a!==t.get(n)&&e.set(n,a);return e}loadSearchParams(t){const e=new URLSearchParams(t);for(const[t,n]of e)this.set(t,n)}toString(){const t=new URLSearchParams;for(const[e,n]of this)t.append(e,n);const e=t.toString();return""!==e?"?"+e:""}}class i{constructor(t){this.chart=t,this.query=this.createDefaultQuery(),window.addEventListener("popstate",()=>this.updatePage(),!1)}run(t=""){var e;(e="/data/daily_reports/summary.json",new Promise((t,n)=>{i.get(e,e=>{t(JSON.parse(e.responseText))},t=>{n(t)})})).then(e=>{this.chart.addData(e),this.initQuery(t),this.change()}).catch(t=>{console.error(t)})}dispose(){var t;null===(t=this.chart)||void 0===t||t.dispose()}getQuery(){return this.query.copy()}createQuery(t){return t||(t=this.query),t.filter(this.createDefaultQuery()).toString()}updateQuery(t){const e=this.createQuery(t);e!==location.search?(window.history.pushState("","",location.pathname+e),this.updatePage()):window.history.replaceState("","",location.pathname+e)}updatePage(){const t=this.createQuery();this.loadQuery(location.search);const e=this.createQuery();e!==t?this.change():window.history.replaceState("","",location.pathname+e)}update(t){const e=this.getQuery();for(const[n,a]of t)e.set(n,a);this.updateQuery(e)}static get(t,e,n){const a=new XMLHttpRequest;a.ontimeout=()=>{console.error(`The request for ${t} timed out.`),n("ontimeout")},a.onload=()=>{4===a.readyState&&(200===a.status?e(a):console.error(a.statusText))},a.onerror=()=>{console.error(a.statusText),n("onerror")},a.open("GET",t,!0),a.timeout=5e3,a.send(null)}}},90:function(t,e,n){"use strict";n.r(e);var a=n(1),i=n(3),r=n(4),s=n.n(r),o=n(0),c=n(2);const d=[new Date(2099,11,31),new Date(2001,0,1)],h=[0,0];class l extends o.a{constructor(t){super(t),this.candledata=[],this.candlewidth=10,this.candle_x=a.k().domain(d.concat()).range([0,this.width]),this.candle_xAxis=a.a(this.candle_x).tickSizeInner(-this.height).tickFormat(o.q).tickPadding(7).ticks(5),this.candle_yLiner=a.h(),this.candle_yLog=a.i().clamp(!0),this.candle_y=this.candle_yLiner,this.candle_yAxis=a.b(this.candle_yLiner).tickSizeInner(-this.width).tickFormat(o.k).tickPadding(7).ticks(5),this.resetScale(y.nowyscale),this.candle_color=a.j().range(["#b94047","#47ba41","#4147ba","#bab441","#41bab4","#b441ba"]),this.candle_color.domain(["red","green","blue"]),this.candle_rect_stroke=t=>t.open>t.close?this.candle_color("red"):this.candle_color("green")}changeData(t){if(!this.raw)return;this.candledata=[];const e=o.b[t],n=this.raw.countrys,a=this.candle_y.domain(),i=[o.p(y.slider.xaxis.value[0]),o.p(y.slider.xaxis.value[1])];a[1]=h[1];const r=o.d(y.nowcountry);if(n.hasOwnProperty(r)){let t,s,c=0,d=0,h=0,l=0,u=0;for(const y of n[r].daily){s=o.p(y.date),void 0===t&&(t=s);const n=Math.max(y.cdr[e]-c,0);c=y.cdr[e],s.getTime()<i[0].getTime()||s.getTime()>i[1].getTime()||(n>a[1]&&(a[1]=n),s.getTime()<i[0].getTime()&&(i[0]=s),s.getTime()>i[1].getTime()&&(i[1]=s),h=n,n>l&&(l=n),n<u&&(u=n),1===s.getDay()&&(this.candledata.push({date:new Date(s.getTime()-3.5*o.i),start:new Date(s.getTime()-7*o.i),end:s,open:d,close:h,high:l,low:u}),d=h,l=h,u=h))}if(s&&1!==s.getDay()){const t=(s.getDay()+6)%7,e=new Date(s.getTime()-o.i*t);this.candledata.push({date:new Date(e.getTime()+3.5*o.i),start:e,end:s,open:d,close:h,high:l,low:u})}y.confirmed_now=o.k(n[r].cdr[0]),y.deaths_now=o.k(n[r].cdr[1]),y.recovered_now=o.k(n[r].cdr[2])}if(this.candledata&&this.candledata.length>0){const t=i[0].getTime(),e=i[1].getTime();this.candlewidth=Math.max(Math.floor(this.width/Math.max((e-t)/(7*o.i),1)*.95),3)}else this.candlewidth=10;this.candle_x.domain(i),this.candle_y.domain(a),this.candle_y.nice(),y.slider.xaxis.value[0]=o.q(i[0]),y.slider.xaxis.value[1]=o.q(i[1])}addData(t){this.raw=t,y.countrys=[];const e=d.concat();for(const n in t.countrys){if(!t.countrys.hasOwnProperty(n))continue;const a=t.countrys[n].daily;if(a&&a.length>0){const t=o.p(a[0].date),i=a[a.length-1],r=o.p(i.date);t.getTime()<e[0].getTime()&&(e[0]=t),r.getTime()>e[1].getTime()&&(e[1]=r);const s=i.cdr;y.countrys.push({id:o.e(n),name:n,data:[s[0],s[1],s[2]],checked:!0})}}y.slider.xaxis.value=[o.q(e[0]),o.q(e[1])],y.slider.xaxis.data=this.createDateRange(e[0],e[1])}resetScale(t){const e=this.candle_y.domain();switch(t){case"liner":this.candle_y=this.candle_yLiner,e[0]=0;break;case"log":this.candle_y=this.candle_yLog,e[0]=1;break;default:}this.candle_y.range([this.height,0]),this.candle_y.domain(e),this.candle_y.nice(),this.candle_yAxis.scale(this.candle_y)}draw(){this.candledata&&(this.candle=this.svg.selectAll(".candle").data(this.candledata).enter().append("g").attr("transform",`translate(${this.margin.left},${this.margin.top})`).attr("class","candle"),this.candle.append("rect").style("fill",this.candle_rect_stroke).attr("x",t=>this.candle_x(t.date)-this.candlewidth/2).attr("y",t=>Math.min(this.candle_y(t.open),this.candle_y(t.close))).attr("width",this.candlewidth).attr("height",t=>Math.max(Math.abs(this.candle_y(t.open)-this.candle_y(t.close)),2)),this.candle.append("line").attr("x1",t=>this.candle_x(t.date)).attr("y1",t=>this.candle_y(t.high)).attr("x2",t=>this.candle_x(t.date)).attr("y2",t=>this.candle_y(t.low)).attr("stroke-width",2).style("stroke",this.candle_rect_stroke),this.candle.append("title").text(t=>`date:${o.q(t.start)}-${o.q(t.end)}\nopen:${t.open}\nclose:${t.close}\nhigh:${t.high}\nlow:${t.low}`),this.svg.append("g").attr("class","x axis").attr("transform",`translate(${this.margin.left},${this.height+this.margin.top})`).call(this.candle_xAxis),this.svg.append("g").attr("class","y axis").attr("transform",`translate(${this.margin.left},${this.margin.top})`).call(this.candle_yAxis))}}class u extends c.a{constructor(t=""){super(new l("svgcandle")),this.startdate="20200401",this.enddate="20200410",this.run(t)}createDefaultQuery(){const t=new c.b;return t.set("country",o.g),t.set("category",o.f),t.set("yscale",o.o),t.set("startdate",this.startdate),t.set("enddate",this.enddate),t}loadQuery(t){t||(t=location.search),this.query=this.createDefaultQuery(),this.query.loadSearchParams(t),y.nowcountry=o.e(this.query.get("country")),y.nowcategory=this.query.get("category"),y.nowyscale=this.query.get("yscale"),y.slider.xaxis.value=[this.query.get("startdate"),this.query.get("enddate")]}initQuery(t=""){const e=y.slider.xaxis.data;e.length>=2&&(this.startdate=e[0],this.enddate=e[e.length-1]),this.loadQuery(t),this.updateQuery()}change(){this.chart.clear(),this.chart.resetScale(y.nowyscale),this.chart.changeData(y.nowcategory),this.chart.draw()}}const y={confirmed_now:"",deaths_now:"",recovered_now:"",categorys:[{id:"confirmed",name:"感染数"},{id:"deaths",name:"死亡数"},{id:"recovered",name:"回復数"}],yscales:[{id:"liner",name:"線形"},{id:"log",name:"対数"}],countrys:[],slider:{xaxis:{value:[o.h,o.h],data:[o.h]}},nowcategory:o.f,nowyscale:o.o,nowcountry:o.e(o.g)};new i.default({el:"#container",data:y,components:{VueSlider:s.a},computed:{nowcountrystr:()=>o.d(y.nowcountry),startdate:()=>o.j(y.slider.xaxis.value[0]),enddate:()=>o.j(y.slider.xaxis.value[1]),lastdate:()=>o.j(y.slider.xaxis.data[y.slider.xaxis.data.length-1])},methods:{categoryChange:()=>g.update([["category",y.nowcategory]]),yscaleChange:()=>g.update([["yscale",y.nowyscale]]),countryChange:()=>g.update([["country",o.d(y.nowcountry)]]),sliderChange:()=>g.update([["startdate",y.slider.xaxis.value[0]],["enddate",y.slider.xaxis.value[1]]])}});let g=new u(location.search)}});
//# sourceMappingURL=candle.js.map